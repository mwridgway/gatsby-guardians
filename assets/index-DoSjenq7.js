var ae=Object.defineProperty;var oe=(h,n,t)=>n in h?ae(h,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[n]=t;var p=(h,n,t)=>oe(h,typeof n!="symbol"?n+"":n,t);import{P as S,c as O}from"./phaser-BhRZvspT.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(a){if(a.ep)return;a.ep=!0;const c=t(a);fetch(a.href,c)}})();const E=640,v=360,le=600,$=100,ue=-300,ce=6,de=6,b=16,q=!0,fe=Phaser.Input.Keyboard.Key,J=Phaser.Input.Keyboard.KeyCodes,U=["up","down","left","right"];class he{constructor(n){this.scene=n,this.keys={},this.cursorKeys={},this.noKeyDown=!0;for(var t=0,i=U.length;t<i;t++){var a=U[t];this.addKey(a),this.cursorKeys[a]=this.keys[a]}}shutdown(n){this.scene=void 0;for(var t in this.keys)this.keys[t].destroy();this.keys=void 0,this.cursorKeys=void 0}destroy(n){shutdown(n)}createCursorKeys(){return this.cursorKeys}setKeyState(n,t){var i=this.keys[n];return i.enabled?(t&&(this.noKeyDown=!1),i.isDown!==t&&(K.timeStamp=Date.now(),K.keyCode=i.keyCode,t?i.onDown(K):i.onUp(K)),this):this}clearAllKeysState(){this.noKeyDown=!0;for(var n in this.keys)this.setKeyState(n,!1);return this}getKeyState(n){return this.keys[n]}get upKeyDown(){return this.keys.up.isDown}get downKeyDown(){return this.keys.down.isDown}get leftKeyDown(){return this.keys.left.isDown}get rightKeyDown(){return this.keys.right.isDown}get anyKeyDown(){return!this.noKeyDown}addKey(n,t){return t===void 0&&(t=n),typeof t=="string"&&(t=t.toUpperCase(),J.hasOwnProperty(t)&&(t=J[t])),this.keys[n]=new fe(this.scene,t),this}addKeys(n){for(var t=0,i=n.length;t<i;t++)this.addKey(n[t]);return this}}var K={timeStamp:0,keyCode:0,altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1,location:0};/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */var pe=180/Math.PI,_e=function(h){return h*pe};const me={"up&down":0,"left&right":1,"4dir":2,"8dir":3};var ye=function(h,n,t){switch(t===void 0?t={}:t===!0&&(t=ge),t.left=!1,t.right=!1,t.up=!1,t.down=!1,h=(h+360)%360,n){case 0:h<180?t.down=!0:t.up=!0;break;case 1:h>90&&h<=270?t.left=!0:t.right=!0;break;case 2:h>45&&h<=135?t.down=!0:h>135&&h<=225?t.left=!0:h>225&&h<=315?t.up=!0:t.right=!0;break;case 3:h>22.5&&h<=67.5?(t.down=!0,t.right=!0):h>67.5&&h<=112.5?t.down=!0:h>112.5&&h<=157.5?(t.down=!0,t.left=!0):h>157.5&&h<=202.5?t.left=!0:h>202.5&&h<=247.5?(t.left=!0,t.up=!0):h>247.5&&h<=292.5?t.up=!0:(h>292.5&&h<=337.5&&(t.up=!0),t.right=!0);break}return t},ge={};const I=Phaser.Utils.Objects.GetValue,ve=Phaser.Math.Distance.Between,we=Phaser.Math.Angle.Between;class Ae extends he{constructor(n,t){super(n),this.resetFromJSON(t)}resetFromJSON(n){this.start==null&&(this.start={x:0,y:0}),this.end==null&&(this.end={x:0,y:0}),this._enable=void 0,this.setEnable(I(n,"enable",!0)),this.setMode(I(n,"dir","8dir")),this.setDistanceThreshold(I(n,"forceMin",16));var t=I(n,"start.x",null),i=I(n,"start.y",null),a=I(n,"end.x",null),c=I(n,"end.y",null);return this.setVector(t,i,a,c),this}toJSON(){return{enable:this.enable,dir:this.dirMode,forceMin:this.forceMin,start:{x:this.start.x,y:this.start.y},end:{x:this.end.x,y:this.end.y}}}setMode(n){return typeof n=="string"&&(n=me[n]),this.dirMode=n,this}get enable(){return this._enable}set enable(n){if(this._enable!==n)return n||this.clearVector(),this._enable=n,this}setEnable(n){return n===void 0&&(n=!0),this.enable=n,this}toggleEnable(){return this.setEnable(!this.enable),this}setDistanceThreshold(n){return n<0&&(n=0),this.forceMin=n,this}clearVector(){return this.start.x=0,this.start.y=0,this.end.x=0,this.end.y=0,this.clearAllKeysState(),this}setVector(n,t,i,a){if(!this.enable)return this;if(n===null)return this.clearVector(),this;if(i===void 0&&(i=n,n=0,a=t,t=0),this.start.x=n,this.start.y=t,this.end.x=i,this.end.y=a,this.forceMin>0&&this.force<this.forceMin)this.clearAllKeysState();else{this.noKeyDown=!0;var c=ye(this.angle,this.dirMode,!0);for(var l in c)this.setKeyState(l,c[l])}return this}get forceX(){return this.end.x-this.start.x}get forceY(){return this.end.y-this.start.y}get force(){return ve(this.start.x,this.start.y,this.end.x,this.end.y)}get rotation(){return we(this.start.x,this.start.y,this.end.x,this.end.y)}get angle(){return _e(this.rotation)}get octant(){var n=0;return this.rightKeyDown?n=this.downKeyDown?45:0:this.downKeyDown?n=this.leftKeyDown?135:90:this.leftKeyDown?n=this.upKeyDown?225:180:this.upKeyDown&&(n=this.rightKeyDown?315:270),n}}const z={setEventEmitter(h,n){return n===void 0&&(n=Phaser.Events.EventEmitter),this._privateEE=h===!0||h===void 0,this._eventEmitter=this._privateEE?new n:h,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit(h){return this._eventEmitter&&h&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}};var be=function(h,n,t){var i=h.camera;return i?(t===void 0?t={}:t===!0&&(t=Se),i===n?(t.x=h.worldX,t.y=h.worldY):i.getWorldPoint(h.x,h.y,t),t):null},Se={};const X=Phaser.Utils.Objects.GetValue,xe=Phaser.Geom.Circle,Ee=Phaser.Geom.Circle.Contains;class Z extends Ae{constructor(n,t){var i=n.scene;super(i,t);var a=X(t,"eventEmitter",void 0),c=X(t,"EventEmitterClass",void 0);this.setEventEmitter(a,c),this.scene=i,this.mainCamera=i.sys.cameras.main,this.pointer=void 0,this.gameObject=n,this.radius=X(t,"radius",100),n.setInteractive(new xe(n.displayOriginX,n.displayOriginY,this.radius),Ee),this.boot()}resetFromJSON(n){return super.resetFromJSON(n),this.pointer=void 0,this}toJSON(){var n=super.toJSON();return n.radius=this.radius,n}boot(){this.gameObject.on("pointerdown",this.onKeyDownStart,this),this.gameObject.on("pointerover",this.onKeyDownStart,this),this.scene.input.on("pointermove",this.onKeyDown,this),this.scene.input.on("pointerup",this.onKeyUp,this),this.gameObject.once("destroy",this.onParentDestroy,this)}shutdown(n){this.scene&&(this.scene.input.off("pointermove",this.onKeyDown,this),this.scene.input.off("pointerup",this.onKeyUp,this),this.destroyEventEmitter(),this.scene=void 0,this.mainCamera=void 0,this.pointer=void 0,this.gameObject=void 0,super.shutdown())}get enable(){return this._enable}set enable(n){if(this._enable!==n)return n||(this.pointer=void 0),super.enable=n,this}destroy(n){this.shutdown(n)}onParentDestroy(n,t){this.destroy(t)}onKeyDownStart(n){!n.isDown||this.pointer!==void 0||(this.pointer=n,this.onKeyDown(n),this.emit("pointerdown",n))}onKeyDown(n){if(this.pointer===n){var t=be(n,this.mainCamera,!0);if(t){var i=n.camera,a=this.gameObject,c=a.x-i.scrollX*(a.scrollFactorX-1),l=a.y-i.scrollY*(a.scrollFactorY-1);this.setVector(c,l,t.x,t.y),this.emit("update")}}}onKeyUp(n){this.pointer===n&&(this.pointer=void 0,this.clearVector(),this.emit("update"),this.emit("pointerup",n))}forceUpdate(){var n=this.pointer;return!n||!n.isDown?this:(this.onKeyDown(n),this)}}Object.assign(Z.prototype,z);const F=Phaser.Utils.Objects.GetValue;class Q{constructor(n,t){t===void 0&&(t={});var i=F(t,"eventEmitter",void 0),a=F(t,"EventEmitterClass",void 0);this.setEventEmitter(i,a),t.eventEmitter=this.getEventEmitter(),this.scene=n,this.base=void 0,this.thumb=void 0,this.touchCursor=void 0,this.setRadius(F(t,"radius",100)),this.addBase(F(t,"base",void 0),t),this.addThumb(F(t,"thumb",void 0));var c=F(t,"x",0),l=F(t,"y",0);this.base.setPosition(c,l),this.thumb.setPosition(c,l),F(t,"fixed",!0)&&this.setScrollFactor(0),this.boot()}destroy(){this.destroyEventEmitter(),this.base.destroy(),this.thumb.destroy(),this.scene=void 0,this.base=void 0,this.thumb=void 0,this.touchCursor=void 0}createCursorKeys(){return this.touchCursor.createCursorKeys()}get forceX(){return this.touchCursor.forceX}get forceY(){return this.touchCursor.forceY}get force(){return this.touchCursor.force}get rotation(){return this.touchCursor.rotation}get angle(){return this.touchCursor.angle}get up(){return this.touchCursor.upKeyDown}get down(){return this.touchCursor.downKeyDown}get left(){return this.touchCursor.leftKeyDown}get right(){return this.touchCursor.rightKeyDown}get noKey(){return this.touchCursor.noKeyDown}get pointerX(){return this.touchCursor.end.x}get pointerY(){return this.touchCursor.end.y}get pointer(){return this.touchCursor.pointer}setPosition(n,t){return this.x===n&&this.y===t?this:(this.x=n,this.y=t,this.forceUpdateThumb(),this)}set x(n){this.x!==n&&(this.base.x=n,this.thumb.x=n)}set y(n){this.y!==n&&(this.base.y=n,this.thumb.y=n)}get x(){return this.base.x}get y(){return this.base.y}setVisible(n){return this.visible=n,this}toggleVisible(){return this.visible=!this.visible,this}get visible(){return this.base.visible}set visible(n){this.base.visible=n,this.thumb.visible=n,this.enable=n}get enable(){return this.touchCursor.enable}set enable(n){this.touchCursor.setEnable(n)}setEnable(n){return n===void 0&&(n=!0),this.enable=n,this}toggleEnable(){return this.setEnable(!this.enable),this}setRadius(n){return this.radius=n,this}addBase(n,t){return this.base&&this.base.destroy(),n===void 0&&(n=this.scene.add.circle(0,0,this.radius).setStrokeStyle(3,255)),t===void 0&&(t={}),t.eventEmitter=this.getEventEmitter(),this.touchCursor=new Z(n,t),this.base=n,this}addThumb(n){return this.thumb&&this.thumb.destroy(),n===void 0&&(n=this.scene.add.circle(0,0,40).setStrokeStyle(3,65280)),this.thumb=n,this}setScrollFactor(n){return this.base.setScrollFactor(n),this.thumb.setScrollFactor(n),this}boot(){this.on("update",this.update,this)}update(){var n=this.touchCursor,t,i,a=n.dirMode;if(n.anyKeyDown)if(n.force>this.radius){var c=n.rotation;t=a!==0?Math.cos(c)*this.radius:0,i=a!==1?Math.sin(c)*this.radius:0}else t=a!==0?n.forceX:0,i=a!==1?n.forceY:0;else t=0,i=0;return this.thumb.x=this.base.x+t,this.thumb.y=this.base.y+i,this}forceUpdateThumb(){return this.touchCursor.forceUpdate(),this}}Object.assign(Q.prototype,z);const D=.2;function V(h,n=D){return Math.abs(h)<n?0:h<0?-1:1}var W=(h=>(h.MOVE_LEFT="moveLeft",h.MOVE_RIGHT="moveRight",h.MOVE_UP="moveUp",h.MOVE_DOWN="moveDown",h.JUMP="jump",h.ATTACK="attack",h.PRIMARY_FIRE="primaryFire",h.SECONDARY_FIRE="secondaryFire",h.WEAPON_NEXT="weaponNext",h.WEAPON_PREV="weaponPrev",h.PAUSE="pause",h))(W||{});class Me{constructor(n){p(this,"scene");p(this,"keys");p(this,"previousActions");p(this,"currentActions");p(this,"virtualJoystick",null);p(this,"gamepadIndex",0);p(this,"keysPressed",new Set);this.scene=n,this.keys=new Map,this.previousActions=new Set,this.currentActions=new Set}setupKeyboard(){if(!this.scene.input.keyboard){console.error("InputMapper: Keyboard not available!");return}console.log("InputMapper: Setting up keyboard..."),this.scene.input.keyboard.on("keydown",n=>{this.keysPressed.add(n.code)}),this.scene.input.keyboard.on("keyup",n=>{this.keysPressed.delete(n.code)}),console.log("InputMapper: Keyboard setup complete with event listeners")}setupVirtualJoystick(){if(!("ontouchstart"in window))return;const n=this.scene.add.circle(0,0,50,8947848,.5),t=this.scene.add.circle(0,0,25,13421772,.8);n.setVisible(!1),t.setVisible(!1);const i=this.scene.scale.width/2,a=this.scene.add.zone(i/2,this.scene.scale.height/2,i,this.scene.scale.height);a.setInteractive(),a.setScrollFactor(0),a.setDepth(9998),this.virtualJoystick=new Q(this.scene,{x:i/2,y:this.scene.scale.height/2,radius:50,base:n,thumb:t,dir:"8dir",forceMin:16,enable:!0,fixed:!1}),n.setScrollFactor(0).setDepth(9999),t.setScrollFactor(0).setDepth(1e4);let c=null;a.on("pointerdown",l=>{console.log("Touch zone touched at",l.x,l.y),c=l,n.setPosition(l.x,l.y),t.setPosition(l.x,l.y),n.setVisible(!0),t.setVisible(!0),this.virtualJoystick.x=l.x,this.virtualJoystick.y=l.y,this.virtualJoystick.setPosition(l.x,l.y)}),a.on("pointerup",l=>{c===l&&(console.log("Touch zone released"),c=null,n.setVisible(!1),t.setVisible(!1))}),this.createMobileActionButtons()}createMobileActionButtons(){const n=this.scene.scale.height-60,t=this.scene.add.graphics();t.fillStyle(65280,.6),t.fillCircle(this.scene.scale.width-80,n,30),t.setInteractive(new S.Geom.Circle(this.scene.scale.width-80,n,30),S.Geom.Circle.Contains),t.setScrollFactor(0),t.setDepth(9999);let i=null;t.on("pointerdown",l=>{console.log("Jump button pressed"),i=l,this.currentActions.add("jump")}),t.on("pointerup",l=>{i===l&&(console.log("Jump button released"),i=null,this.currentActions.delete("jump"))}),t.on("pointerout",l=>{i===l&&(i=null,this.currentActions.delete("jump"))});const a=this.scene.add.graphics();a.fillStyle(16711680,.6),a.fillCircle(this.scene.scale.width-80,n-80,30),a.setInteractive(new S.Geom.Circle(this.scene.scale.width-80,n-80,30),S.Geom.Circle.Contains),a.setScrollFactor(0),a.setDepth(9999);let c=null;a.on("pointerdown",l=>{console.log("Fire button pressed"),c=l,this.currentActions.add("primaryFire")}),a.on("pointerup",l=>{c===l&&(console.log("Fire button released"),c=null,this.currentActions.delete("primaryFire"))}),a.on("pointerout",l=>{c===l&&(c=null,this.currentActions.delete("primaryFire"))})}setScene(n){this.scene=n,this.setupKeyboard(),this.setupVirtualJoystick()}update(){this.previousActions=new Set(this.currentActions),this.currentActions.clear(),this.updateKeyboardInput(),this.updateGamepadInput(),this.updateVirtualJoystickInput()}updateKeyboardInput(){const n=this.keysPressed.has("ArrowLeft")||this.keysPressed.has("KeyA"),t=this.keysPressed.has("ArrowRight")||this.keysPressed.has("KeyD"),i=this.keysPressed.has("ArrowUp")||this.keysPressed.has("KeyW"),a=this.keysPressed.has("ArrowDown")||this.keysPressed.has("KeyS");n&&this.currentActions.add("moveLeft"),t&&this.currentActions.add("moveRight"),i&&this.currentActions.add("moveUp"),a&&this.currentActions.add("moveDown"),(this.keysPressed.has("Space")||i)&&this.currentActions.add("jump"),(this.keysPressed.has("KeyZ")||this.keysPressed.has("KeyJ"))&&this.currentActions.add("primaryFire"),(this.keysPressed.has("KeyX")||this.keysPressed.has("KeyK"))&&this.currentActions.add("secondaryFire"),this.keysPressed.has("KeyQ")&&this.currentActions.add("weaponPrev"),this.keysPressed.has("KeyE")&&this.currentActions.add("weaponNext"),this.keysPressed.has("Escape")&&this.currentActions.add("pause"),(this.keysPressed.has("KeyZ")||this.keysPressed.has("KeyX"))&&this.currentActions.add("attack")}updateGamepadInput(){const t=(navigator.getGamepads?navigator.getGamepads():[])[this.gamepadIndex];if(!t)return;const i=t.axes,a=V(i[0],D),c=V(i[1],D);(a<0||t.buttons[14]?.pressed)&&this.currentActions.add("moveLeft"),(a>0||t.buttons[15]?.pressed)&&this.currentActions.add("moveRight"),(c<0||t.buttons[12]?.pressed)&&this.currentActions.add("moveUp"),(c>0||t.buttons[13]?.pressed)&&this.currentActions.add("moveDown"),t.buttons[0]?.pressed&&this.currentActions.add("jump"),t.buttons[2]?.pressed&&this.currentActions.add("primaryFire"),t.buttons[1]?.pressed&&this.currentActions.add("secondaryFire"),t.buttons[4]?.pressed&&this.currentActions.add("weaponPrev"),t.buttons[5]?.pressed&&this.currentActions.add("weaponNext"),t.buttons[9]?.pressed&&this.currentActions.add("pause"),t.buttons[2]?.pressed&&this.currentActions.add("attack")}updateVirtualJoystickInput(){if(!this.virtualJoystick)return;const n=this.virtualJoystick.forceX||0,t=this.virtualJoystick.forceY||0;(n!==0||t!==0)&&console.log("VirtualJoystick force:",n,t);const i=V(n,D),a=V(t,D);i<0&&this.currentActions.add("moveLeft"),i>0&&this.currentActions.add("moveRight"),a<0&&this.currentActions.add("moveUp"),a>0&&this.currentActions.add("moveDown")}isActionActive(n){return this.currentActions.has(n)}isActionJustPressed(n){return this.currentActions.has(n)&&!this.previousActions.has(n)}getAxis(){let n=0,t=0;return this.isActionActive("moveLeft")&&(n-=1),this.isActionActive("moveRight")&&(n+=1),this.isActionActive("moveUp")&&(t-=1),this.isActionActive("moveDown")&&(t+=1),{x:n,y:t}}getInputState(){return{moveX:this.getAxis().x,moveY:this.getAxis().y,jumpActive:this.isActionActive("jump"),jumpJustPressed:this.isActionJustPressed("jump"),primaryFire:this.isActionActive("primaryFire"),primaryFireJustPressed:this.isActionJustPressed("primaryFire"),secondaryFire:this.isActionActive("secondaryFire"),secondaryFireJustPressed:this.isActionJustPressed("secondaryFire"),weaponNext:this.isActionJustPressed("weaponNext"),weaponPrevious:this.isActionJustPressed("weaponPrev"),pause:this.isActionActive("pause"),pauseJustPressed:this.isActionJustPressed("pause")}}destroy(){this.keys.clear(),this.currentActions.clear(),this.previousActions.clear()}}var k={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(h){(function(){var n=function(){this.init()};n.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator=typeof window<"u"&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var r=this||t;if(e=parseFloat(e),r.ctx||M(),typeof e<"u"&&e>=0&&e<=1){if(r._volume=e,r._muted)return r;r.usingWebAudio&&r.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var s=0;s<r._howls.length;s++)if(!r._howls[s]._webAudio)for(var o=r._howls[s]._getSoundIds(),d=0;d<o.length;d++){var f=r._howls[s]._soundById(o[d]);f&&f._node&&(f._node.volume=f._volume*e)}return r}return r._volume},mute:function(e){var r=this||t;r.ctx||M(),r._muted=e,r.usingWebAudio&&r.masterGain.gain.setValueAtTime(e?0:r._volume,t.ctx.currentTime);for(var s=0;s<r._howls.length;s++)if(!r._howls[s]._webAudio)for(var o=r._howls[s]._getSoundIds(),d=0;d<o.length;d++){var f=r._howls[s]._soundById(o[d]);f&&f._node&&(f._node.muted=e?!0:f._muted)}return r},stop:function(){for(var e=this||t,r=0;r<e._howls.length;r++)e._howls[r].stop();return e},unload:function(){for(var e=this||t,r=e._howls.length-1;r>=0;r--)e._howls[r].unload();return e.usingWebAudio&&e.ctx&&typeof e.ctx.close<"u"&&(e.ctx.close(),e.ctx=null,M()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if(typeof Audio<"u")try{var r=new Audio;typeof r.oncanplaythrough>"u"&&(e._canPlayEvent="canplay")}catch{e.noAudio=!0}else e.noAudio=!0;try{var r=new Audio;r.muted&&(e.noAudio=!0)}catch{}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,r=null;try{r=typeof Audio<"u"?new Audio:null}catch{return e}if(!r||typeof r.canPlayType!="function")return e;var s=r.canPlayType("audio/mpeg;").replace(/^no$/,""),o=e._navigator?e._navigator.userAgent:"",d=o.match(/OPR\/(\d+)/g),f=d&&parseInt(d[0].split("/")[1],10)<33,u=o.indexOf("Safari")!==-1&&o.indexOf("Chrome")===-1,m=o.match(/Version\/(.*?) /),w=u&&m&&parseInt(m[1],10)<15;return e._codecs={mp3:!!(!f&&(s||r.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!s,opus:!!r.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!r.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!r.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(r.canPlayType('audio/wav; codecs="1"')||r.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!r.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!r.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(r.canPlayType("audio/x-m4a;")||r.canPlayType("audio/m4a;")||r.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(r.canPlayType("audio/x-m4b;")||r.canPlayType("audio/m4b;")||r.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(r.canPlayType("audio/x-mp4;")||r.canPlayType("audio/mp4;")||r.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!w&&r.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!w&&r.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!r.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(r.canPlayType("audio/x-flac;")||r.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!(e._audioUnlocked||!e.ctx)){e._audioUnlocked=!1,e.autoUnlock=!1,!e._mobileUnloaded&&e.ctx.sampleRate!==44100&&(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var r=function(s){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var o=new Audio;o._unlocked=!0,e._releaseHtml5Audio(o)}catch{e.noAudio=!0;break}for(var d=0;d<e._howls.length;d++)if(!e._howls[d]._webAudio)for(var f=e._howls[d]._getSoundIds(),u=0;u<f.length;u++){var m=e._howls[d]._soundById(f[u]);m&&m._node&&!m._node._unlocked&&(m._node._unlocked=!0,m._node.load())}e._autoResume();var w=e.ctx.createBufferSource();w.buffer=e._scratchBuffer,w.connect(e.ctx.destination),typeof w.start>"u"?w.noteOn(0):w.start(0),typeof e.ctx.resume=="function"&&e.ctx.resume(),w.onended=function(){w.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",r,!0),document.removeEventListener("touchend",r,!0),document.removeEventListener("click",r,!0),document.removeEventListener("keydown",r,!0);for(var x=0;x<e._howls.length;x++)e._howls[x]._emit("unlock")}};return document.addEventListener("touchstart",r,!0),document.addEventListener("touchend",r,!0),document.addEventListener("click",r,!0),document.addEventListener("keydown",r,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var r=new Audio().play();return r&&typeof Promise<"u"&&(r instanceof Promise||typeof r.then=="function")&&r.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(e){var r=this||t;return e._unlocked&&r._html5AudioPool.push(e),r},_autoSuspend:function(){var e=this;if(!(!e.autoSuspend||!e.ctx||typeof e.ctx.suspend>"u"||!t.usingWebAudio)){for(var r=0;r<e._howls.length;r++)if(e._howls[r]._webAudio){for(var s=0;s<e._howls[r]._sounds.length;s++)if(!e._howls[r]._sounds[s]._paused)return e}return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var o=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(o,o)}},3e4),e}},_autoResume:function(){var e=this;if(!(!e.ctx||typeof e.ctx.resume>"u"||!t.usingWebAudio))return e.state==="running"&&e.ctx.state!=="interrupted"&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):e.state==="suspended"||e.state==="running"&&e.ctx.state==="interrupted"?(e.ctx.resume().then(function(){e.state="running";for(var r=0;r<e._howls.length;r++)e._howls[r]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):e.state==="suspending"&&(e._resumeAfterSuspend=!0),e}};var t=new n,i=function(e){var r=this;if(!e.src||e.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}r.init(e)};i.prototype={init:function(e){var r=this;return t.ctx||M(),r._autoplay=e.autoplay||!1,r._format=typeof e.format!="string"?e.format:[e.format],r._html5=e.html5||!1,r._muted=e.mute||!1,r._loop=e.loop||!1,r._pool=e.pool||5,r._preload=typeof e.preload=="boolean"||e.preload==="metadata"?e.preload:!0,r._rate=e.rate||1,r._sprite=e.sprite||{},r._src=typeof e.src!="string"?e.src:[e.src],r._volume=e.volume!==void 0?e.volume:1,r._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:e.xhr&&e.xhr.withCredentials?e.xhr.withCredentials:!1},r._duration=0,r._state="unloaded",r._sounds=[],r._endTimers={},r._queue=[],r._playLock=!1,r._onend=e.onend?[{fn:e.onend}]:[],r._onfade=e.onfade?[{fn:e.onfade}]:[],r._onload=e.onload?[{fn:e.onload}]:[],r._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],r._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],r._onpause=e.onpause?[{fn:e.onpause}]:[],r._onplay=e.onplay?[{fn:e.onplay}]:[],r._onstop=e.onstop?[{fn:e.onstop}]:[],r._onmute=e.onmute?[{fn:e.onmute}]:[],r._onvolume=e.onvolume?[{fn:e.onvolume}]:[],r._onrate=e.onrate?[{fn:e.onrate}]:[],r._onseek=e.onseek?[{fn:e.onseek}]:[],r._onunlock=e.onunlock?[{fn:e.onunlock}]:[],r._onresume=[],r._webAudio=t.usingWebAudio&&!r._html5,typeof t.ctx<"u"&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(r),r._autoplay&&r._queue.push({event:"play",action:function(){r.play()}}),r._preload&&r._preload!=="none"&&r.load(),r},load:function(){var e=this,r=null;if(t.noAudio){e._emit("loaderror",null,"No audio support.");return}typeof e._src=="string"&&(e._src=[e._src]);for(var s=0;s<e._src.length;s++){var o,d;if(e._format&&e._format[s])o=e._format[s];else{if(d=e._src[s],typeof d!="string"){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}o=/^data:audio\/([^;,]+);/i.exec(d),o||(o=/\.([^.]+)$/.exec(d.split("?",1)[0])),o&&(o=o[1].toLowerCase())}if(o||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),o&&t.codecs(o)){r=e._src[s];break}}if(!r){e._emit("loaderror",null,"No codec support for selected audio sources.");return}return e._src=r,e._state="loading",window.location.protocol==="https:"&&r.slice(0,5)==="http:"&&(e._html5=!0,e._webAudio=!1),new a(e),e._webAudio&&l(e),e},play:function(e,r){var s=this,o=null;if(typeof e=="number")o=e,e=null;else{if(typeof e=="string"&&s._state==="loaded"&&!s._sprite[e])return null;if(typeof e>"u"&&(e="__default",!s._playLock)){for(var d=0,f=0;f<s._sounds.length;f++)s._sounds[f]._paused&&!s._sounds[f]._ended&&(d++,o=s._sounds[f]._id);d===1?e=null:o=null}}var u=o?s._soundById(o):s._inactiveSound();if(!u)return null;if(o&&!e&&(e=u._sprite||"__default"),s._state!=="loaded"){u._sprite=e,u._ended=!1;var m=u._id;return s._queue.push({event:"play",action:function(){s.play(m)}}),m}if(o&&!u._paused)return r||s._loadQueue("play"),u._id;s._webAudio&&t._autoResume();var w=Math.max(0,u._seek>0?u._seek:s._sprite[e][0]/1e3),x=Math.max(0,(s._sprite[e][0]+s._sprite[e][1])/1e3-w),P=x*1e3/Math.abs(u._rate),C=s._sprite[e][0]/1e3,B=(s._sprite[e][0]+s._sprite[e][1])/1e3;u._sprite=e,u._ended=!1;var R=function(){u._paused=!1,u._seek=w,u._start=C,u._stop=B,u._loop=!!(u._loop||s._sprite[e][2])};if(w>=B){s._ended(u);return}var A=u._node;if(s._webAudio){var Y=function(){s._playLock=!1,R(),s._refreshBuffer(u);var L=u._muted||s._muted?0:u._volume;A.gain.setValueAtTime(L,t.ctx.currentTime),u._playStart=t.ctx.currentTime,typeof A.bufferSource.start>"u"?u._loop?A.bufferSource.noteGrainOn(0,w,86400):A.bufferSource.noteGrainOn(0,w,x):u._loop?A.bufferSource.start(0,w,86400):A.bufferSource.start(0,w,x),P!==1/0&&(s._endTimers[u._id]=setTimeout(s._ended.bind(s,u),P)),r||setTimeout(function(){s._emit("play",u._id),s._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?Y():(s._playLock=!0,s.once("resume",Y),s._clearTimer(u._id))}else{var N=function(){A.currentTime=w,A.muted=u._muted||s._muted||t._muted||A.muted,A.volume=u._volume*t.volume(),A.playbackRate=u._rate;try{var L=A.play();if(L&&typeof Promise<"u"&&(L instanceof Promise||typeof L.then=="function")?(s._playLock=!0,R(),L.then(function(){s._playLock=!1,A._unlocked=!0,r?s._loadQueue():s._emit("play",u._id)}).catch(function(){s._playLock=!1,s._emit("playerror",u._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),u._ended=!0,u._paused=!0})):r||(s._playLock=!1,R(),s._emit("play",u._id)),A.playbackRate=u._rate,A.paused){s._emit("playerror",u._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}e!=="__default"||u._loop?s._endTimers[u._id]=setTimeout(s._ended.bind(s,u),P):(s._endTimers[u._id]=function(){s._ended(u),A.removeEventListener("ended",s._endTimers[u._id],!1)},A.addEventListener("ended",s._endTimers[u._id],!1))}catch(se){s._emit("playerror",u._id,se)}};A.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(A.src=s._src,A.load());var ie=window&&window.ejecta||!A.readyState&&t._navigator.isCocoonJS;if(A.readyState>=3||ie)N();else{s._playLock=!0,s._state="loading";var j=function(){s._state="loaded",N(),A.removeEventListener(t._canPlayEvent,j,!1)};A.addEventListener(t._canPlayEvent,j,!1),s._clearTimer(u._id)}}return u._id},pause:function(e){var r=this;if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"pause",action:function(){r.pause(e)}}),r;for(var s=r._getSoundIds(e),o=0;o<s.length;o++){r._clearTimer(s[o]);var d=r._soundById(s[o]);if(d&&!d._paused&&(d._seek=r.seek(s[o]),d._rateSeek=0,d._paused=!0,r._stopFade(s[o]),d._node))if(r._webAudio){if(!d._node.bufferSource)continue;typeof d._node.bufferSource.stop>"u"?d._node.bufferSource.noteOff(0):d._node.bufferSource.stop(0),r._cleanBuffer(d._node)}else(!isNaN(d._node.duration)||d._node.duration===1/0)&&d._node.pause();arguments[1]||r._emit("pause",d?d._id:null)}return r},stop:function(e,r){var s=this;if(s._state!=="loaded"||s._playLock)return s._queue.push({event:"stop",action:function(){s.stop(e)}}),s;for(var o=s._getSoundIds(e),d=0;d<o.length;d++){s._clearTimer(o[d]);var f=s._soundById(o[d]);f&&(f._seek=f._start||0,f._rateSeek=0,f._paused=!0,f._ended=!0,s._stopFade(o[d]),f._node&&(s._webAudio?f._node.bufferSource&&(typeof f._node.bufferSource.stop>"u"?f._node.bufferSource.noteOff(0):f._node.bufferSource.stop(0),s._cleanBuffer(f._node)):(!isNaN(f._node.duration)||f._node.duration===1/0)&&(f._node.currentTime=f._start||0,f._node.pause(),f._node.duration===1/0&&s._clearSound(f._node))),r||s._emit("stop",f._id))}return s},mute:function(e,r){var s=this;if(s._state!=="loaded"||s._playLock)return s._queue.push({event:"mute",action:function(){s.mute(e,r)}}),s;if(typeof r>"u")if(typeof e=="boolean")s._muted=e;else return s._muted;for(var o=s._getSoundIds(r),d=0;d<o.length;d++){var f=s._soundById(o[d]);f&&(f._muted=e,f._interval&&s._stopFade(f._id),s._webAudio&&f._node?f._node.gain.setValueAtTime(e?0:f._volume,t.ctx.currentTime):f._node&&(f._node.muted=t._muted?!0:e),s._emit("mute",f._id))}return s},volume:function(){var e=this,r=arguments,s,o;if(r.length===0)return e._volume;if(r.length===1||r.length===2&&typeof r[1]>"u"){var d=e._getSoundIds(),f=d.indexOf(r[0]);f>=0?o=parseInt(r[0],10):s=parseFloat(r[0])}else r.length>=2&&(s=parseFloat(r[0]),o=parseInt(r[1],10));var u;if(typeof s<"u"&&s>=0&&s<=1){if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"volume",action:function(){e.volume.apply(e,r)}}),e;typeof o>"u"&&(e._volume=s),o=e._getSoundIds(o);for(var m=0;m<o.length;m++)u=e._soundById(o[m]),u&&(u._volume=s,r[2]||e._stopFade(o[m]),e._webAudio&&u._node&&!u._muted?u._node.gain.setValueAtTime(s,t.ctx.currentTime):u._node&&!u._muted&&(u._node.volume=s*t.volume()),e._emit("volume",u._id))}else return u=o?e._soundById(o):e._sounds[0],u?u._volume:0;return e},fade:function(e,r,s,o){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"fade",action:function(){d.fade(e,r,s,o)}}),d;e=Math.min(Math.max(0,parseFloat(e)),1),r=Math.min(Math.max(0,parseFloat(r)),1),s=parseFloat(s),d.volume(e,o);for(var f=d._getSoundIds(o),u=0;u<f.length;u++){var m=d._soundById(f[u]);if(m){if(o||d._stopFade(f[u]),d._webAudio&&!m._muted){var w=t.ctx.currentTime,x=w+s/1e3;m._volume=e,m._node.gain.setValueAtTime(e,w),m._node.gain.linearRampToValueAtTime(r,x)}d._startFadeInterval(m,e,r,s,f[u],typeof o>"u")}}return d},_startFadeInterval:function(e,r,s,o,d,f){var u=this,m=r,w=s-r,x=Math.abs(w/.01),P=Math.max(4,x>0?o/x:o),C=Date.now();e._fadeTo=s,e._interval=setInterval(function(){var B=(Date.now()-C)/o;C=Date.now(),m+=w*B,m=Math.round(m*100)/100,w<0?m=Math.max(s,m):m=Math.min(s,m),u._webAudio?e._volume=m:u.volume(m,e._id,!0),f&&(u._volume=m),(s<r&&m<=s||s>r&&m>=s)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,u.volume(s,e._id),u._emit("fade",e._id))},P)},_stopFade:function(e){var r=this,s=r._soundById(e);return s&&s._interval&&(r._webAudio&&s._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(s._interval),s._interval=null,r.volume(s._fadeTo,e),s._fadeTo=null,r._emit("fade",e)),r},loop:function(){var e=this,r=arguments,s,o,d;if(r.length===0)return e._loop;if(r.length===1)if(typeof r[0]=="boolean")s=r[0],e._loop=s;else return d=e._soundById(parseInt(r[0],10)),d?d._loop:!1;else r.length===2&&(s=r[0],o=parseInt(r[1],10));for(var f=e._getSoundIds(o),u=0;u<f.length;u++)d=e._soundById(f[u]),d&&(d._loop=s,e._webAudio&&d._node&&d._node.bufferSource&&(d._node.bufferSource.loop=s,s&&(d._node.bufferSource.loopStart=d._start||0,d._node.bufferSource.loopEnd=d._stop,e.playing(f[u])&&(e.pause(f[u],!0),e.play(f[u],!0)))));return e},rate:function(){var e=this,r=arguments,s,o;if(r.length===0)o=e._sounds[0]._id;else if(r.length===1){var d=e._getSoundIds(),f=d.indexOf(r[0]);f>=0?o=parseInt(r[0],10):s=parseFloat(r[0])}else r.length===2&&(s=parseFloat(r[0]),o=parseInt(r[1],10));var u;if(typeof s=="number"){if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"rate",action:function(){e.rate.apply(e,r)}}),e;typeof o>"u"&&(e._rate=s),o=e._getSoundIds(o);for(var m=0;m<o.length;m++)if(u=e._soundById(o[m]),u){e.playing(o[m])&&(u._rateSeek=e.seek(o[m]),u._playStart=e._webAudio?t.ctx.currentTime:u._playStart),u._rate=s,e._webAudio&&u._node&&u._node.bufferSource?u._node.bufferSource.playbackRate.setValueAtTime(s,t.ctx.currentTime):u._node&&(u._node.playbackRate=s);var w=e.seek(o[m]),x=(e._sprite[u._sprite][0]+e._sprite[u._sprite][1])/1e3-w,P=x*1e3/Math.abs(u._rate);(e._endTimers[o[m]]||!u._paused)&&(e._clearTimer(o[m]),e._endTimers[o[m]]=setTimeout(e._ended.bind(e,u),P)),e._emit("rate",u._id)}}else return u=e._soundById(o),u?u._rate:e._rate;return e},seek:function(){var e=this,r=arguments,s,o;if(r.length===0)e._sounds.length&&(o=e._sounds[0]._id);else if(r.length===1){var d=e._getSoundIds(),f=d.indexOf(r[0]);f>=0?o=parseInt(r[0],10):e._sounds.length&&(o=e._sounds[0]._id,s=parseFloat(r[0]))}else r.length===2&&(s=parseFloat(r[0]),o=parseInt(r[1],10));if(typeof o>"u")return 0;if(typeof s=="number"&&(e._state!=="loaded"||e._playLock))return e._queue.push({event:"seek",action:function(){e.seek.apply(e,r)}}),e;var u=e._soundById(o);if(u)if(typeof s=="number"&&s>=0){var m=e.playing(o);m&&e.pause(o,!0),u._seek=s,u._ended=!1,e._clearTimer(o),!e._webAudio&&u._node&&!isNaN(u._node.duration)&&(u._node.currentTime=s);var w=function(){m&&e.play(o,!0),e._emit("seek",o)};if(m&&!e._webAudio){var x=function(){e._playLock?setTimeout(x,0):w()};setTimeout(x,0)}else w()}else if(e._webAudio){var P=e.playing(o)?t.ctx.currentTime-u._playStart:0,C=u._rateSeek?u._rateSeek-u._seek:0;return u._seek+(C+P*Math.abs(u._rate))}else return u._node.currentTime;return e},playing:function(e){var r=this;if(typeof e=="number"){var s=r._soundById(e);return s?!s._paused:!1}for(var o=0;o<r._sounds.length;o++)if(!r._sounds[o]._paused)return!0;return!1},duration:function(e){var r=this,s=r._duration,o=r._soundById(e);return o&&(s=r._sprite[o._sprite][1]/1e3),s},state:function(){return this._state},unload:function(){for(var e=this,r=e._sounds,s=0;s<r.length;s++)r[s]._paused||e.stop(r[s]._id),e._webAudio||(e._clearSound(r[s]._node),r[s]._node.removeEventListener("error",r[s]._errorFn,!1),r[s]._node.removeEventListener(t._canPlayEvent,r[s]._loadFn,!1),r[s]._node.removeEventListener("ended",r[s]._endFn,!1),t._releaseHtml5Audio(r[s]._node)),delete r[s]._node,e._clearTimer(r[s]._id);var o=t._howls.indexOf(e);o>=0&&t._howls.splice(o,1);var d=!0;for(s=0;s<t._howls.length;s++)if(t._howls[s]._src===e._src||e._src.indexOf(t._howls[s]._src)>=0){d=!1;break}return c&&d&&delete c[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,r,s,o){var d=this,f=d["_on"+e];return typeof r=="function"&&f.push(o?{id:s,fn:r,once:o}:{id:s,fn:r}),d},off:function(e,r,s){var o=this,d=o["_on"+e],f=0;if(typeof r=="number"&&(s=r,r=null),r||s)for(f=0;f<d.length;f++){var u=s===d[f].id;if(r===d[f].fn&&u||!r&&u){d.splice(f,1);break}}else if(e)o["_on"+e]=[];else{var m=Object.keys(o);for(f=0;f<m.length;f++)m[f].indexOf("_on")===0&&Array.isArray(o[m[f]])&&(o[m[f]]=[])}return o},once:function(e,r,s){var o=this;return o.on(e,r,s,1),o},_emit:function(e,r,s){for(var o=this,d=o["_on"+e],f=d.length-1;f>=0;f--)(!d[f].id||d[f].id===r||e==="load")&&(setTimeout(function(u){u.call(this,r,s)}.bind(o,d[f].fn),0),d[f].once&&o.off(e,d[f].fn,d[f].id));return o._loadQueue(e),o},_loadQueue:function(e){var r=this;if(r._queue.length>0){var s=r._queue[0];s.event===e&&(r._queue.shift(),r._loadQueue()),e||s.action()}return r},_ended:function(e){var r=this,s=e._sprite;if(!r._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(r._ended.bind(r,e),100),r;var o=!!(e._loop||r._sprite[s][2]);if(r._emit("end",e._id),!r._webAudio&&o&&r.stop(e._id,!0).play(e._id),r._webAudio&&o){r._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var d=(e._stop-e._start)*1e3/Math.abs(e._rate);r._endTimers[e._id]=setTimeout(r._ended.bind(r,e),d)}return r._webAudio&&!o&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,r._clearTimer(e._id),r._cleanBuffer(e._node),t._autoSuspend()),!r._webAudio&&!o&&r.stop(e._id,!0),r},_clearTimer:function(e){var r=this;if(r._endTimers[e]){if(typeof r._endTimers[e]!="function")clearTimeout(r._endTimers[e]);else{var s=r._soundById(e);s&&s._node&&s._node.removeEventListener("ended",r._endTimers[e],!1)}delete r._endTimers[e]}return r},_soundById:function(e){for(var r=this,s=0;s<r._sounds.length;s++)if(e===r._sounds[s]._id)return r._sounds[s];return null},_inactiveSound:function(){var e=this;e._drain();for(var r=0;r<e._sounds.length;r++)if(e._sounds[r]._ended)return e._sounds[r].reset();return new a(e)},_drain:function(){var e=this,r=e._pool,s=0,o=0;if(!(e._sounds.length<r)){for(o=0;o<e._sounds.length;o++)e._sounds[o]._ended&&s++;for(o=e._sounds.length-1;o>=0;o--){if(s<=r)return;e._sounds[o]._ended&&(e._webAudio&&e._sounds[o]._node&&e._sounds[o]._node.disconnect(0),e._sounds.splice(o,1),s--)}}},_getSoundIds:function(e){var r=this;if(typeof e>"u"){for(var s=[],o=0;o<r._sounds.length;o++)s.push(r._sounds[o]._id);return s}else return[e]},_refreshBuffer:function(e){var r=this;return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=c[r._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),r},_cleanBuffer:function(e){var r=this,s=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(!e.bufferSource)return r;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),s))try{e.bufferSource.buffer=t._scratchBuffer}catch{}return e.bufferSource=null,r},_clearSound:function(e){var r=/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent);r||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(e){this._parent=e,this.init()};a.prototype={init:function(){var e=this,r=e._parent;return e._muted=r._muted,e._loop=r._loop,e._volume=r._volume,e._rate=r._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,r._sounds.push(e),e.create(),e},create:function(){var e=this,r=e._parent,s=t._muted||e._muted||e._parent._muted?0:e._volume;return r._webAudio?(e._node=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(s,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):t.noAudio||(e._node=t._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=r._src,e._node.preload=r._preload===!0?"auto":r._preload,e._node.volume=s*t.volume(),e._node.load()),e},reset:function(){var e=this,r=e._parent;return e._muted=r._muted,e._loop=r._loop,e._volume=r._volume,e._rate=r._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,r=e._parent;r._duration=Math.ceil(e._node.duration*10)/10,Object.keys(r._sprite).length===0&&(r._sprite={__default:[0,r._duration*1e3]}),r._state!=="loaded"&&(r._state="loaded",r._emit("load"),r._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,r=e._parent;r._duration===1/0&&(r._duration=Math.ceil(e._node.duration*10)/10,r._sprite.__default[1]===1/0&&(r._sprite.__default[1]=r._duration*1e3),r._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var c={},l=function(e){var r=e._src;if(c[r]){e._duration=c[r].duration,_(e);return}if(/^data:[^;]+;base64,/.test(r)){for(var s=atob(r.split(",")[1]),o=new Uint8Array(s.length),d=0;d<s.length;++d)o[d]=s.charCodeAt(d);y(o.buffer,e)}else{var f=new XMLHttpRequest;f.open(e._xhr.method,r,!0),f.withCredentials=e._xhr.withCredentials,f.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach(function(u){f.setRequestHeader(u,e._xhr.headers[u])}),f.onload=function(){var u=(f.status+"")[0];if(u!=="0"&&u!=="2"&&u!=="3"){e._emit("loaderror",null,"Failed loading audio file with status: "+f.status+".");return}y(f.response,e)},f.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete c[r],e.load())},g(f)}},g=function(e){try{e.send()}catch{e.onerror()}},y=function(e,r){var s=function(){r._emit("loaderror",null,"Decoding audio data failed.")},o=function(d){d&&r._sounds.length>0?(c[r._src]=d,_(r,d)):s()};typeof Promise<"u"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(e).then(o).catch(s):t.ctx.decodeAudioData(e,o,s)},_=function(e,r){r&&!e._duration&&(e._duration=r.duration),Object.keys(e._sprite).length===0&&(e._sprite={__default:[0,e._duration*1e3]}),e._state!=="loaded"&&(e._state="loaded",e._emit("load"),e._loadQueue())},M=function(){if(t.usingWebAudio){try{typeof AudioContext<"u"?t.ctx=new AudioContext:typeof webkitAudioContext<"u"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),r=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),s=r?parseInt(r[1],10):null;if(e&&s&&s<9){var o=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!o&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};h.Howler=t,h.Howl=i,typeof O<"u"?(O.HowlerGlobal=n,O.Howler=t,O.Howl=i,O.Sound=a):typeof window<"u"&&(window.HowlerGlobal=n,window.Howler=t,window.Howl=i,window.Sound=a)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var a=i._howls.length-1;a>=0;a--)i._howls[a].stereo(t);return i},HowlerGlobal.prototype.pos=function(t,i,a){var c=this;if(!c.ctx||!c.ctx.listener)return c;if(i=typeof i!="number"?c._pos[1]:i,a=typeof a!="number"?c._pos[2]:a,typeof t=="number")c._pos=[t,i,a],typeof c.ctx.listener.positionX<"u"?(c.ctx.listener.positionX.setTargetAtTime(c._pos[0],Howler.ctx.currentTime,.1),c.ctx.listener.positionY.setTargetAtTime(c._pos[1],Howler.ctx.currentTime,.1),c.ctx.listener.positionZ.setTargetAtTime(c._pos[2],Howler.ctx.currentTime,.1)):c.ctx.listener.setPosition(c._pos[0],c._pos[1],c._pos[2]);else return c._pos;return c},HowlerGlobal.prototype.orientation=function(t,i,a,c,l,g){var y=this;if(!y.ctx||!y.ctx.listener)return y;var _=y._orientation;if(i=typeof i!="number"?_[1]:i,a=typeof a!="number"?_[2]:a,c=typeof c!="number"?_[3]:c,l=typeof l!="number"?_[4]:l,g=typeof g!="number"?_[5]:g,typeof t=="number")y._orientation=[t,i,a,c,l,g],typeof y.ctx.listener.forwardX<"u"?(y.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),y.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),y.ctx.listener.forwardZ.setTargetAtTime(a,Howler.ctx.currentTime,.1),y.ctx.listener.upX.setTargetAtTime(c,Howler.ctx.currentTime,.1),y.ctx.listener.upY.setTargetAtTime(l,Howler.ctx.currentTime,.1),y.ctx.listener.upZ.setTargetAtTime(g,Howler.ctx.currentTime,.1)):y.ctx.listener.setOrientation(t,i,a,c,l,g);else return _;return y},Howl.prototype.init=function(t){return function(i){var a=this;return a._orientation=i.orientation||[1,0,0],a._stereo=i.stereo||null,a._pos=i.pos||null,a._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance<"u"?i.maxDistance:1e4,panningModel:typeof i.panningModel<"u"?i.panningModel:"HRTF",refDistance:typeof i.refDistance<"u"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:1},a._onstereo=i.onstereo?[{fn:i.onstereo}]:[],a._onpos=i.onpos?[{fn:i.onpos}]:[],a._onorientation=i.onorientation?[{fn:i.onorientation}]:[],t.call(this,i)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,i){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"stereo",action:function(){a.stereo(t,i)}}),a;var c=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof i>"u")if(typeof t=="number")a._stereo=t,a._pos=[t,0,0];else return a._stereo;for(var l=a._getSoundIds(i),g=0;g<l.length;g++){var y=a._soundById(l[g]);if(y)if(typeof t=="number")y._stereo=t,y._pos=[t,0,0],y._node&&(y._pannerAttr.panningModel="equalpower",(!y._panner||!y._panner.pan)&&n(y,c),c==="spatial"?typeof y._panner.positionX<"u"?(y._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),y._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),y._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):y._panner.setPosition(t,0,0):y._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),a._emit("stereo",y._id);else return y._stereo}return a},Howl.prototype.pos=function(t,i,a,c){var l=this;if(!l._webAudio)return l;if(l._state!=="loaded")return l._queue.push({event:"pos",action:function(){l.pos(t,i,a,c)}}),l;if(i=typeof i!="number"?0:i,a=typeof a!="number"?-.5:a,typeof c>"u")if(typeof t=="number")l._pos=[t,i,a];else return l._pos;for(var g=l._getSoundIds(c),y=0;y<g.length;y++){var _=l._soundById(g[y]);if(_)if(typeof t=="number")_._pos=[t,i,a],_._node&&((!_._panner||_._panner.pan)&&n(_,"spatial"),typeof _._panner.positionX<"u"?(_._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),_._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),_._panner.positionZ.setValueAtTime(a,Howler.ctx.currentTime)):_._panner.setPosition(t,i,a)),l._emit("pos",_._id);else return _._pos}return l},Howl.prototype.orientation=function(t,i,a,c){var l=this;if(!l._webAudio)return l;if(l._state!=="loaded")return l._queue.push({event:"orientation",action:function(){l.orientation(t,i,a,c)}}),l;if(i=typeof i!="number"?l._orientation[1]:i,a=typeof a!="number"?l._orientation[2]:a,typeof c>"u")if(typeof t=="number")l._orientation=[t,i,a];else return l._orientation;for(var g=l._getSoundIds(c),y=0;y<g.length;y++){var _=l._soundById(g[y]);if(_)if(typeof t=="number")_._orientation=[t,i,a],_._node&&(_._panner||(_._pos||(_._pos=l._pos||[0,0,-.5]),n(_,"spatial")),typeof _._panner.orientationX<"u"?(_._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),_._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),_._panner.orientationZ.setValueAtTime(a,Howler.ctx.currentTime)):_._panner.setOrientation(t,i,a)),l._emit("orientation",_._id);else return _._orientation}return l},Howl.prototype.pannerAttr=function(){var t=this,i=arguments,a,c,l;if(!t._webAudio)return t;if(i.length===0)return t._pannerAttr;if(i.length===1)if(typeof i[0]=="object")a=i[0],typeof c>"u"&&(a.pannerAttr||(a.pannerAttr={coneInnerAngle:a.coneInnerAngle,coneOuterAngle:a.coneOuterAngle,coneOuterGain:a.coneOuterGain,distanceModel:a.distanceModel,maxDistance:a.maxDistance,refDistance:a.refDistance,rolloffFactor:a.rolloffFactor,panningModel:a.panningModel}),t._pannerAttr={coneInnerAngle:typeof a.pannerAttr.coneInnerAngle<"u"?a.pannerAttr.coneInnerAngle:t._coneInnerAngle,coneOuterAngle:typeof a.pannerAttr.coneOuterAngle<"u"?a.pannerAttr.coneOuterAngle:t._coneOuterAngle,coneOuterGain:typeof a.pannerAttr.coneOuterGain<"u"?a.pannerAttr.coneOuterGain:t._coneOuterGain,distanceModel:typeof a.pannerAttr.distanceModel<"u"?a.pannerAttr.distanceModel:t._distanceModel,maxDistance:typeof a.pannerAttr.maxDistance<"u"?a.pannerAttr.maxDistance:t._maxDistance,refDistance:typeof a.pannerAttr.refDistance<"u"?a.pannerAttr.refDistance:t._refDistance,rolloffFactor:typeof a.pannerAttr.rolloffFactor<"u"?a.pannerAttr.rolloffFactor:t._rolloffFactor,panningModel:typeof a.pannerAttr.panningModel<"u"?a.pannerAttr.panningModel:t._panningModel});else return l=t._soundById(parseInt(i[0],10)),l?l._pannerAttr:t._pannerAttr;else i.length===2&&(a=i[0],c=parseInt(i[1],10));for(var g=t._getSoundIds(c),y=0;y<g.length;y++)if(l=t._soundById(g[y]),l){var _=l._pannerAttr;_={coneInnerAngle:typeof a.coneInnerAngle<"u"?a.coneInnerAngle:_.coneInnerAngle,coneOuterAngle:typeof a.coneOuterAngle<"u"?a.coneOuterAngle:_.coneOuterAngle,coneOuterGain:typeof a.coneOuterGain<"u"?a.coneOuterGain:_.coneOuterGain,distanceModel:typeof a.distanceModel<"u"?a.distanceModel:_.distanceModel,maxDistance:typeof a.maxDistance<"u"?a.maxDistance:_.maxDistance,refDistance:typeof a.refDistance<"u"?a.refDistance:_.refDistance,rolloffFactor:typeof a.rolloffFactor<"u"?a.rolloffFactor:_.rolloffFactor,panningModel:typeof a.panningModel<"u"?a.panningModel:_.panningModel};var M=l._panner;M||(l._pos||(l._pos=t._pos||[0,0,-.5]),n(l,"spatial"),M=l._panner),M.coneInnerAngle=_.coneInnerAngle,M.coneOuterAngle=_.coneOuterAngle,M.coneOuterGain=_.coneOuterGain,M.distanceModel=_.distanceModel,M.maxDistance=_.maxDistance,M.refDistance=_.refDistance,M.rolloffFactor=_.rolloffFactor,M.panningModel=_.panningModel}return t},Sound.prototype.init=function(t){return function(){var i=this,a=i._parent;i._orientation=a._orientation,i._stereo=a._stereo,i._pos=a._pos,i._pannerAttr=a._pannerAttr,t.call(this),i._stereo?a.stereo(i._stereo):i._pos&&a.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var i=this,a=i._parent;return i._orientation=a._orientation,i._stereo=a._stereo,i._pos=a._pos,i._pannerAttr=a._pannerAttr,i._stereo?a.stereo(i._stereo):i._pos?a.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,a._refreshBuffer(i)),t.call(this)}}(Sound.prototype.reset);var n=function(t,i){i=i||"spatial",i==="spatial"?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,typeof t._panner.positionX<"u"?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),typeof t._panner.orientationX<"u"?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}})()})(k);class Te{constructor(){p(this,"music");p(this,"sfx");p(this,"currentMusic",null);p(this,"musicVolume",.7);p(this,"sfxVolume",.8);p(this,"unlocked",!1);this.music=new Map,this.sfx=new Map,this.setupMobileAudioUnlock()}setupMobileAudioUnlock(){if(typeof window>"u")return;const n=()=>{if(this.unlocked)return;const t=new k.Howl({src:["data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAAABmYWN0BAAAAAAAAABkYXRhAAAAAA=="],volume:0});t.play(),t.on("end",()=>{t.unload()}),k.Howler.ctx&&k.Howler.ctx.state==="suspended"&&k.Howler.ctx.resume(),this.unlocked=!0,console.log("Audio context unlocked"),document.removeEventListener("touchstart",n),document.removeEventListener("touchend",n),document.removeEventListener("click",n)};document.addEventListener("touchstart",n),document.addEventListener("touchend",n),document.addEventListener("click",n)}loadMusic(n,t){const i=new k.Howl({src:t,loop:!0,volume:this.musicVolume,html5:!0});this.music.set(n,i)}loadSFX(n,t,i){const a=new k.Howl({src:t,volume:this.sfxVolume,sprite:i});this.sfx.set(n,a)}playMusic(n,t=!0){const i=this.music.get(n);if(!i){console.warn(`Music track not found: ${n}`);return}this.currentMusic&&this.currentMusic!==i&&(this.currentMusic.fade(this.musicVolume,0,500),this.currentMusic.once("fade",()=>{this.currentMusic?.stop()})),this.currentMusic=i,t?(i.volume(0),i.play(),i.fade(0,this.musicVolume,1e3)):(i.volume(this.musicVolume),i.play())}stopMusic(n=!0){this.currentMusic&&(n?(this.currentMusic.fade(this.musicVolume,0,500),this.currentMusic.once("fade",()=>{this.currentMusic?.stop(),this.currentMusic=null})):(this.currentMusic.stop(),this.currentMusic=null))}playSFX(n,t){const i=this.sfx.get(n);if(!i){console.warn(`SFX not found: ${n}`);return}t?i.play(t):i.play()}setMusicVolume(n){this.musicVolume=Phaser.Math.Clamp(n,0,1),this.music.forEach(t=>{t.volume(this.musicVolume)})}setSFXVolume(n){this.sfxVolume=Phaser.Math.Clamp(n,0,1),this.sfx.forEach(t=>{t.volume(this.sfxVolume)})}getMusicVolume(){return this.musicVolume}getSFXVolume(){return this.sfxVolume}muteAll(){k.Howler.mute(!0)}unmuteAll(){k.Howler.mute(!1)}destroy(){this.music.forEach(n=>n.unload()),this.sfx.forEach(n=>n.unload()),this.music.clear(),this.sfx.clear(),this.currentMusic=null}}class Pe{constructor(){p(this,"platform","mock");p(this,"initialized",!1);this.detectPlatform()}detectPlatform(){typeof window>"u"||(window.PokiSDK?(this.platform="poki",console.log("AdManager: Poki SDK detected")):window.CrazyGames?(this.platform="crazygames",console.log("AdManager: CrazyGames SDK detected")):(this.platform="mock",console.log("AdManager: Running in mock mode (localhost)")))}async init(){if(!this.initialized)try{this.platform==="poki"?(await window.PokiSDK.init(),console.log("Poki SDK initialized")):this.platform==="crazygames"?(window.CrazyGames.init(),console.log("CrazyGames SDK initialized")):console.log("Mock ad platform initialized"),this.initialized=!0}catch(n){console.error("Failed to initialize ad platform:",n)}}gameLoadingStart(){this.platform==="poki"?window.PokiSDK.gameLoadingStart():this.platform==="mock"&&console.log("[Mock] Game loading started")}gameLoadingFinished(){this.platform==="poki"?window.PokiSDK.gameLoadingFinished():this.platform==="mock"&&console.log("[Mock] Game loading finished")}gameplayStart(){this.platform==="crazygames"?window.CrazyGames.game.gameplayStart():this.platform==="mock"&&console.log("[Mock] Gameplay started")}gameplayStop(){this.platform==="crazygames"?window.CrazyGames.game.gameplayStop():this.platform==="mock"&&console.log("[Mock] Gameplay stopped")}async showInterstitial(){if(console.log("Showing interstitial ad..."),this.platform==="poki")await window.PokiSDK.commercialBreak();else{if(this.platform==="crazygames")return new Promise(n=>{window.CrazyGames.ad.requestAd("midgame",{adFinished:()=>n(),adError:()=>n()})});console.log("[Mock] Showing interstitial ad (2s)"),await new Promise(n=>setTimeout(n,2e3))}console.log("Interstitial ad finished")}async showRewarded(){if(console.log("Showing rewarded ad..."),this.platform==="poki"){const n=await window.PokiSDK.rewardedBreak();return console.log("Rewarded ad finished:",n?"granted":"skipped"),n}else return this.platform==="crazygames"?new Promise(n=>{window.CrazyGames.ad.requestAd("rewarded",{adFinished:()=>n(!0),adError:()=>n(!1)})}):(console.log("[Mock] Showing rewarded ad (2s) - reward granted"),await new Promise(n=>setTimeout(n,2e3)),!0)}happyTime(){this.platform==="crazygames"?window.CrazyGames.game.happytime():this.platform==="mock"&&console.log("[Mock] Happy time!")}getPlatform(){return this.platform}}var T=(h=>(h.POLONY_PUMMELER="polonypummeler",h.CHIP_SHOTGUN="chipshotgun",h.CALAMARI_WHIP="calamariwhip",h.MASALA_FLAMER="masalaflamer",h))(T||{});class H{constructor(n,t){p(this,"scene");p(this,"config");p(this,"cooldownFrames",0);p(this,"owner",null);this.scene=n,this.config=t}setOwner(n){this.owner=n}update(){this.cooldownFrames>0&&this.cooldownFrames--}fire(n){return this.cooldownFrames>0||!this.owner?!1:(this.onFire(n),this.cooldownFrames=this.config.fireRate,!0)}canFire(){return this.cooldownFrames===0&&this.owner!==null}getType(){return this.config.type}getName(){return this.config.name}getConfig(){return this.config}}class ke extends H{constructor(t){const i={type:T.POLONY_PUMMELER,name:"Polony Pummeler",fireRate:15,damage:10,saturationPerHit:5,range:24};super(t,i);p(this,"hitbox",null)}onFire(t){if(!this.owner)return;const i=this.owner.x+t.x*this.config.range,a=this.owner.y;this.hitbox=this.scene.add.zone(i,a,20,24),this.scene.physics.add.existing(this.hitbox),this.scene.time.delayedCall(50,()=>{this.hitbox&&(this.hitbox.destroy(),this.hitbox=null)}),console.log(`Polony Pummeler swing at (${i}, ${a})`)}getHitbox(){return this.hitbox}destroy(){this.hitbox&&(this.hitbox.destroy(),this.hitbox=null)}}class Fe extends S.Physics.Arcade.Sprite{constructor(t,i,a){const c=t.add.graphics();c.fillStyle(16776960,1),c.fillRect(0,0,8,8),c.generateTexture("projectile-placeholder",8,8),c.destroy();super(t,i,a,"projectile-placeholder");p(this,"lifetimeFrames",0);p(this,"_damage",0);p(this,"_saturation",0);t.add.existing(this),t.physics.add.existing(this)}launch(t,i,a,c){this.setPosition(t,i),this.setActive(!0),this.setVisible(!0);const l=this.body;l.setVelocity(a.x,a.y),l.setAllowGravity(!1),this._damage=c.damage,this._saturation=c.saturation,this.lifetimeFrames=c.lifetime}update(){if(!this.active)return;this.lifetimeFrames--,this.lifetimeFrames<=0&&this.deactivate();const t=this.body;t&&(this.rotation=Math.atan2(t.velocity.y,t.velocity.x))}deactivate(){this.setActive(!1),this.setVisible(!1);const t=this.body;t&&t.setVelocity(0,0)}getDamage(){return this._damage}getSaturation(){return this._saturation}}class Ie{constructor(n,t,i=50){p(this,"pool");this.pool=n.add.group({classType:t,maxSize:i,runChildUpdate:!1})}get(){const n=this.pool.get();return n&&(n.setActive(!0),n.setVisible(!0)),n}release(n){"setActive"in n&&n.setActive(!1),"setVisible"in n&&n.setVisible(!1),this.pool.killAndHide(n)}getGroup(){return this.pool}clear(){this.pool.clear(!0,!0)}}class Ce extends H{constructor(t){const i={type:T.CHIP_SHOTGUN,name:"Chip Shotgun",fireRate:30,damage:5,saturationPerHit:3,projectileSpeed:200};super(t,i);p(this,"projectilePool");p(this,"projectiles",new Set);this.projectilePool=new Ie(t,Fe,30)}onFire(t){if(!this.owner)return;const i=[-15,0,15],a=Math.atan2(t.y,t.x);i.forEach(c=>{const l=a+c*Math.PI/180,g={x:Math.cos(l)*this.config.projectileSpeed,y:Math.sin(l)*this.config.projectileSpeed},y=this.projectilePool.get();if(y){const _={sprite:"chip-projectile",speed:this.config.projectileSpeed,damage:this.config.damage,saturation:this.config.saturationPerHit,lifetime:120};y.launch(this.owner.x,this.owner.y,g,_),this.projectiles.add(y)}}),console.log("Chip Shotgun fired 3 projectiles in spread pattern")}update(){super.update(),this.projectiles.forEach(t=>{t.active?t.update():(this.projectiles.delete(t),this.projectilePool.release(t))})}getProjectileGroup(){return this.projectilePool.getGroup()}destroy(){this.projectiles.forEach(t=>this.projectilePool.release(t)),this.projectiles.clear(),this.projectilePool.clear()}}class Le extends H{constructor(t){const i={type:T.CALAMARI_WHIP,name:"Calamari Whip",fireRate:45,damage:3,saturationPerHit:2,range:150};super(t,i);p(this,"whipLine",null)}onFire(t){if(!this.owner)return;const i=this.owner.x+t.x*this.config.range,a=this.owner.y+t.y*this.config.range;this.whipLine=this.scene.add.line(0,0,this.owner.x,this.owner.y,i,a,16777215),this.whipLine.setOrigin(0,0),this.whipLine.setLineWidth(2),console.log(`Calamari Whip extends to (${i}, ${a})`),this.scene.time.delayedCall(166,()=>{this.whipLine&&(this.whipLine.destroy(),this.whipLine=null)})}getWhipLine(){return this.whipLine}destroy(){this.whipLine&&(this.whipLine.destroy(),this.whipLine=null)}}class Oe extends H{constructor(t){const i={type:T.MASALA_FLAMER,name:"Masala Flamer",fireRate:2,damage:1,saturationPerHit:.5,range:80};super(t,i);p(this,"flameCone",null);p(this,"isFiring",!1)}onFire(t){if(!this.owner)return;if(this.isFiring=!0,!this.flameCone){const a=this.config.range;this.flameCone=this.scene.add.triangle(this.owner.x,this.owner.y,0,0,a,-20,a,20,16737792,.6)}this.flameCone.setPosition(this.owner.x,this.owner.y);const i=Math.atan2(t.y,t.x);this.flameCone.setRotation(i),console.log("Masala Flamer firing continuously")}stopFiring(){this.isFiring=!1,this.flameCone&&(this.flameCone.destroy(),this.flameCone=null)}update(){super.update(),!this.isFiring&&this.flameCone&&(this.flameCone.destroy(),this.flameCone=null)}getFlameCone(){return this.flameCone}destroy(){this.flameCone&&(this.flameCone.destroy(),this.flameCone=null)}}class De{constructor(n){p(this,"weapons");p(this,"currentWeapon");p(this,"weaponOrder",[T.POLONY_PUMMELER,T.CHIP_SHOTGUN,T.CALAMARI_WHIP,T.MASALA_FLAMER]);p(this,"currentIndex",0);this.weapons=new Map,this.weapons.set(T.POLONY_PUMMELER,new ke(n)),this.weapons.set(T.CHIP_SHOTGUN,new Ce(n)),this.weapons.set(T.CALAMARI_WHIP,new Le(n)),this.weapons.set(T.MASALA_FLAMER,new Oe(n)),this.currentWeapon=this.weapons.get(this.weaponOrder[0])}setOwner(n){this.weapons.forEach(t=>t.setOwner(n))}update(){this.weapons.forEach(n=>n.update())}nextWeapon(){this.currentIndex=(this.currentIndex+1)%this.weaponOrder.length,this.currentWeapon=this.weapons.get(this.weaponOrder[this.currentIndex]),console.log(`Switched to: ${this.currentWeapon.getName()}`)}previousWeapon(){this.currentIndex=(this.currentIndex-1+this.weaponOrder.length)%this.weaponOrder.length,this.currentWeapon=this.weapons.get(this.weaponOrder[this.currentIndex]),console.log(`Switched to: ${this.currentWeapon.getName()}`)}fire(n){return this.currentWeapon.fire(n)}getCurrentWeapon(){return this.currentWeapon}getWeapon(n){return this.weapons.get(n)}setScene(n){}destroy(){this.weapons.forEach(n=>n.destroy()),this.weapons.clear()}}class Be{constructor(n){p(this,"activeEffects");p(this,"target",null);this.activeEffects=new Map}setTarget(n){this.target=n}applyEffect(n){if(!this.target)return;const t=n.getType();this.activeEffects.has(t)&&this.removeEffect(t),n.apply(this.target),this.activeEffects.set(t,n)}removeEffect(n){const t=this.activeEffects.get(n);t&&(t.remove(),this.activeEffects.delete(n))}update(){const n=[];this.activeEffects.forEach((t,i)=>{t.update(),t.hasExpired()&&n.push(i)}),n.forEach(t=>this.removeEffect(t))}hasEffect(n){return this.activeEffects.has(n)}getEffect(n){return this.activeEffects.get(n)}clearAll(){this.activeEffects.forEach(n=>n.remove()),this.activeEffects.clear()}setScene(n){}destroy(){this.clearAll()}}class Ke extends S.Scene{constructor(){super({key:"BootScene"});p(this,"inputMapper");p(this,"audioManager");p(this,"adManager");p(this,"weaponManager");p(this,"statusEffectManager")}create(){console.log("BootScene: Initializing systems..."),this.inputMapper=new Me(this),this.audioManager=new Te,this.adManager=new Pe,this.weaponManager=new De(this),this.statusEffectManager=new Be(this),this.registry.set("inputMapper",this.inputMapper),this.registry.set("audioManager",this.audioManager),this.registry.set("adManager",this.adManager),this.registry.set("weaponManager",this.weaponManager),this.registry.set("statusEffectManager",this.statusEffectManager),this.adManager.init().then(()=>{this.adManager.gameLoadingStart()}),console.log("BootScene: Systems initialized"),this.scene.start("PreloadScene")}}class Ve extends S.Scene{constructor(){super({key:"PreloadScene"});p(this,"progressBar");p(this,"progressBox");p(this,"loadingText");p(this,"percentText")}preload(){this.createLoadingScreen(),this.load.on("progress",this.onProgress,this),this.load.on("complete",this.onComplete,this),this.load.spritesheet("input-prompts","assets/input-prompts.png",{frameWidth:16,frameHeight:16,spacing:1,margin:0}),this.load.image("parallax-sky","assets/parallax-sky.png"),this.load.image("parallax-mountains","assets/parallax-mountains.png"),this.load.image("parallax-mid","assets/parallax-mid.png"),this.load.image("parallax-foreground","assets/parallax-foreground.png")}createLoadingScreen(){const t=E,i=v;this.loadingText=this.add.text(t/2,i/2-50,"Loading...",{fontFamily:"Arial",fontSize:"20px",color:"#ffffff"}),this.loadingText.setOrigin(.5),this.percentText=this.add.text(t/2,i/2,"0%",{fontFamily:"Arial",fontSize:"18px",color:"#ffffff"}),this.percentText.setOrigin(.5),this.progressBox=this.add.graphics(),this.progressBox.fillStyle(2236962,.8),this.progressBox.fillRect(t/2-160,i/2+20,320,30),this.progressBar=this.add.graphics()}onProgress(t){this.percentText.setText(Math.floor(t*100)+"%"),this.progressBar.clear(),this.progressBar.fillStyle(65280,1),this.progressBar.fillRect(E/2-155,v/2+25,310*t,20)}onComplete(){this.progressBar.destroy(),this.progressBox.destroy(),this.loadingText.destroy(),this.percentText.destroy();const t=this.registry.get("adManager");t&&t.gameLoadingFinished(),console.log("PreloadScene: Assets loaded"),this.time.delayedCall(500,()=>{this.scene.start("MainMenuScene")})}}class Ge extends S.Scene{constructor(){super({key:"MainMenuScene"});p(this,"inputMapper");p(this,"titleText");p(this,"playButton");p(this,"creditsText")}create(){this.inputMapper=this.registry.get("inputMapper"),this.inputMapper.setScene(this),this.titleText=this.add.text(E/2,v/3,"GATSBY GUARDIANS",{fontFamily:"Arial Black",fontSize:"32px",color:"#00ff00",stroke:"#000000",strokeThickness:6}),this.titleText.setOrigin(.5),this.playButton=this.add.text(E/2,v/2,"PRESS SPACE TO PLAY",{fontFamily:"Arial",fontSize:"20px",color:"#ffffff"}),this.playButton.setOrigin(.5),this.playButton.setInteractive({useHandCursor:!0}),this.playButton.on("pointerover",()=>{this.playButton.setColor("#00ff00")}),this.playButton.on("pointerout",()=>{this.playButton.setColor("#ffffff")}),this.playButton.on("pointerdown",()=>{this.startGame()}),this.tweens.add({targets:this.playButton,alpha:.3,duration:800,yoyo:!0,repeat:-1}),this.creditsText=this.add.text(E/2,v-30,"A Retro Platformer Game",{fontFamily:"Arial",fontSize:"12px",color:"#888888"}),this.creditsText.setOrigin(.5),console.log("MainMenuScene: Ready")}update(){this.inputMapper&&(this.inputMapper.update(),this.inputMapper.isActionJustPressed(W.JUMP)&&this.startGame())}startGame(){console.log("Starting game..."),this.tweens.killTweensOf(this.playButton),console.log("Transitioning to GamePlayScene..."),this.scene.start("GamePlayScene")}}var G=(h=>(h.SOGGY="soggy",h))(G||{});class He{constructor(n){p(this,"config");p(this,"remainingFrames");p(this,"target",null);this.config=n,this.remainingFrames=n.duration}apply(n){this.target=n,this.onApply()}update(){this.remainingFrames>0&&this.remainingFrames--,this.onUpdate()}remove(){this.onRemove(),this.target=null}hasExpired(){return this.config.duration!==-1&&this.remainingFrames<=0}getType(){return this.config.type}}class Re extends He{constructor(t=300){const i={type:G.SOGGY,duration:t};super(i);p(this,"SPEED_MULTIPLIER",1.5);p(this,"DAMAGE_MULTIPLIER",2);p(this,"originalSpeed",$)}onApply(){this.target&&(this.originalSpeed=this.target.getSpeed(),this.target.setSpeed(this.originalSpeed*this.SPEED_MULTIPLIER),this.target.setTint(8947967),console.log("Soggy effect applied! Speed increased, damage vulnerability doubled."))}onUpdate(){}onRemove(){this.target&&(this.target.setSpeed(this.originalSpeed),this.target.clearTint(),console.log("Soggy effect removed."))}getDamageMultiplier(){return this.DAMAGE_MULTIPLIER}}class ee extends S.Physics.Arcade.Sprite{constructor(t,i,a,c){const l=t.add.graphics();l.fillStyle(65280,1),l.fillRect(0,0,16,16),l.generateTexture("player-placeholder",16,16),l.destroy();super(t,i,a,"player-placeholder");p(this,"inputMapper");p(this,"weaponManager");p(this,"statusEffectManager");p(this,"coyoteFrames",0);p(this,"jumpBufferFrames",0);p(this,"currentSpeed",$);if(this.inputMapper=c,this.weaponManager=t.registry.get("weaponManager"),this.statusEffectManager=t.registry.get("statusEffectManager"),t.add.existing(this),t.physics.add.existing(this),this.weaponManager&&this.weaponManager.setOwner(this),this.statusEffectManager&&this.statusEffectManager.setTarget(this),this.body){const g=this.body;g.setCollideWorldBounds(!0),g.setSize(14,16),g.setOffset(1,0)}this.setOrigin(.5,.5)}update(t,i){if(!this.body)return;const a=this.body;this.weaponManager&&this.weaponManager.update(),this.statusEffectManager&&this.statusEffectManager.update(),a.onFloor()?this.coyoteFrames=ce:this.coyoteFrames>0&&this.coyoteFrames--;const c=this.coyoteFrames>0;this.inputMapper.isActionJustPressed(W.JUMP)&&(c?this.jump():this.jumpBufferFrames=de),this.jumpBufferFrames>0&&(c?(this.jump(),this.jumpBufferFrames=0):this.jumpBufferFrames--);const l=this.inputMapper.getAxis();l.x!==0?(a.setVelocityX(l.x*this.currentSpeed),l.x<0?this.setFlipX(!0):l.x>0&&this.setFlipX(!1)):(a.setVelocityX(a.velocity.x*.9),Math.abs(a.velocity.x)<1&&a.setVelocityX(0)),this.x=Math.round(this.x),this.y=Math.round(this.y),this.handleWeaponInput(),this.updateAnimation()}handleWeaponInput(){if(!this.weaponManager)return;const t=this.inputMapper.getInputState();if(t.weaponNext&&this.weaponManager.nextWeapon(),t.weaponPrevious&&this.weaponManager.previousWeapon(),t.primaryFireJustPressed||t.primaryFire){const i={x:this.flipX?-1:1,y:0};this.weaponManager.fire(i)}}jump(){if(!this.body)return;this.body.setVelocityY(ue),this.coyoteFrames=0}updateAnimation(){if(!this.body)return;const t=this.body;t.onFloor()?Math.abs(t.velocity.x)>1?this.setTint(65280):this.setTint(52224):this.setTint(43520)}takeDamage(t){let i=t;if(this.statusEffectManager){const a=this.statusEffectManager.getEffect(G.SOGGY);a&&(i*=a.getDamageMultiplier())}console.log(`Player took ${i} damage (base: ${t})`),this.setTint(16711680),this.scene.time.delayedCall(100,()=>{!this.statusEffectManager||!this.statusEffectManager.hasEffect(G.SOGGY)?this.clearTint():this.setTint(8947967)})}applySoggy(t=300){if(!this.statusEffectManager)return;const i=new Re(t);this.statusEffectManager.applyEffect(i)}getSpeed(){return this.currentSpeed}setSpeed(t){this.currentSpeed=t}reset(t,i){this.setPosition(t,i),this.body&&this.body.setVelocity(0,0),this.clearTint(),this.coyoteFrames=0,this.jumpBufferFrames=0}}class te{constructor(n,t=!0){p(this,"scene");p(this,"enabled",!1);p(this,"indicatorText");p(this,"buttonContainer");p(this,"sceneMap",new Map([[1,"GamePlayScene"],[2,"SideScrollerScene"]]));this.scene=n,this.enabled=t,this.enabled&&(this.setupKeyboardShortcuts(),this.createButtons())}setupKeyboardShortcuts(){const n={1:S.Input.Keyboard.KeyCodes.ONE,2:S.Input.Keyboard.KeyCodes.TWO,3:S.Input.Keyboard.KeyCodes.THREE,4:S.Input.Keyboard.KeyCodes.FOUR};this.sceneMap.forEach((a,c)=>{const l=n[c];if(l){const g=this.scene.input.keyboard?.addKey(l);g&&g.on("down",()=>this.switchToScene(a))}});const t=this.scene.input.keyboard?.addKey(S.Input.Keyboard.KeyCodes.ESC);t&&t.on("down",()=>this.switchToScene("MainMenuScene"));const i=this.scene.input.keyboard?.addKey(S.Input.Keyboard.KeyCodes.BACKTICK);i&&i.on("down",()=>this.toggleIndicator())}createButtons(){this.buttonContainer=this.scene.add.container(0,0),this.buttonContainer.setScrollFactor(0),this.buttonContainer.setDepth(9997);const t=16*2.5,i=10,a=t+8,c=this.scene.cameras.main.width-t-i,l=i,g={one:51,two:52,esc:17};this.createSceneButton(c,l,g.esc,"MainMenuScene","ESC: Menu"),this.createSceneButton(c-a,l,g.two,"SideScrollerScene","2: Side-Scroller"),this.createSceneButton(c-a*2,l,g.one,"GamePlayScene","1: Platformer")}createSceneButton(n,t,i,a,c){const l=this.scene.add.sprite(n,t,"input-prompts",i);l.setScale(2.5),l.setAlpha(.75),l.setOrigin(0,0),l.setInteractive({useHandCursor:!0}),l.on("pointerover",()=>{l.setAlpha(1),l.setScale(2.7)}),l.on("pointerout",()=>{l.setAlpha(.75),l.setScale(2.5)}),l.on("pointerdown",()=>{l.setScale(2.3),this.switchToScene(a)}),l.on("pointerup",()=>{l.setScale(2.5)}),this.buttonContainer?.add(l)}toggleIndicator(){this.buttonContainer&&this.buttonContainer.setVisible(!this.buttonContainer.visible)}switchToScene(n){console.log(`SceneSwitcher: Switching to ${n}`),this.showTransitionFeedback(n),this.scene.time.delayedCall(100,()=>{this.scene.scene.start(n)})}showTransitionFeedback(n){const t=this.scene.add.text(this.scene.cameras.main.width/2,this.scene.cameras.main.height/2,`Switching to ${n}...`,{fontFamily:"Arial",fontSize:"16px",color:"#ffffff",backgroundColor:"#000000",padding:{x:10,y:6}});t.setOrigin(.5),t.setScrollFactor(0),t.setDepth(10001),this.scene.tweens.add({targets:t,alpha:0,duration:300,onComplete:()=>t.destroy()})}setEnabled(n){this.enabled=n,this.indicatorText&&this.indicatorText.setVisible(n)}destroy(){this.indicatorText&&this.indicatorText.destroy(),this.buttonContainer&&this.buttonContainer.destroy()}}class re{constructor(n){p(this,"scene");p(this,"button");p(this,"isFullscreen",!1);this.scene=n,this.createFullscreenButton(),this.setupFullscreenListeners()}createFullscreenButton(){const l=this.scene.add.sprite(10,10,"input-prompts",133);l.setScale(2.5),l.setAlpha(.75),l.setOrigin(0,0),l.setScrollFactor(0),l.setDepth(9998),l.setInteractive({useHandCursor:!0}),l.on("pointerover",()=>{l.setAlpha(1),l.setScale(2.7)}),l.on("pointerout",()=>{l.setAlpha(.75),l.setScale(2.5)}),l.on("pointerdown",()=>{l.setScale(2.3),this.toggleFullscreen()}),l.on("pointerup",()=>{l.setScale(2.5)}),this.button=this.scene.add.container(0,0),this.button.add(l)}setupFullscreenListeners(){document.addEventListener("fullscreenchange",()=>this.onFullscreenChange()),document.addEventListener("webkitfullscreenchange",()=>this.onFullscreenChange()),document.addEventListener("mozfullscreenchange",()=>this.onFullscreenChange()),document.addEventListener("MSFullscreenChange",()=>this.onFullscreenChange())}onFullscreenChange(){this.isFullscreen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement),this.updateButtonIcon(),console.log("Fullscreen state changed:",this.isFullscreen)}updateButtonIcon(){}toggleFullscreen(){this.isFullscreen?this.exitFullscreen():this.enterFullscreen()}enterFullscreen(){const n=this.scene.game.canvas;n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.msRequestFullscreen&&n.msRequestFullscreen(),screen.orientation&&"lock"in screen.orientation&&screen.orientation.lock("landscape").catch(()=>{console.log("Orientation lock not supported")})}exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}setVisible(n){this.button&&this.button.setVisible(n)}destroy(){this.button&&this.button.destroy(),document.removeEventListener("fullscreenchange",()=>this.onFullscreenChange()),document.removeEventListener("webkitfullscreenchange",()=>this.onFullscreenChange()),document.removeEventListener("mozfullscreenchange",()=>this.onFullscreenChange()),document.removeEventListener("MSFullscreenChange",()=>this.onFullscreenChange())}}class Xe extends S.Scene{constructor(){super({key:"GamePlayScene"});p(this,"inputMapper");p(this,"adManager");p(this,"player");p(this,"platforms");p(this,"fullscreenManager")}create(){console.log("GamePlayScene: Starting level..."),this.inputMapper=this.registry.get("inputMapper"),this.adManager=this.registry.get("adManager"),this.inputMapper.setScene(this),this.adManager.gameplayStart(),this.cameras.main.setBackgroundColor("#87CEEB"),this.createPlatforms(),this.createPlayer(),this.cameras.main.setBounds(0,0,E,v),this.cameras.main.startFollow(this.player,!1,.1,.1),this.fullscreenManager=new re(this),this.fullscreenManager,new te(this,q),console.log("GamePlayScene: Level ready")}createPlatforms(){this.platforms=this.physics.add.staticGroup();const t=v-b;for(let i=0;i<E;i+=b){const a=this.add.rectangle(i+b/2,t+b/2,b,b,6636321);this.physics.add.existing(a,!0),this.platforms.add(a)}this.createPlatform(E/4,v-100,4),this.createPlatform(E/2,v-150,5),this.createPlatform(E*3/4,v-100,4)}createPlatform(t,i,a){for(let c=0;c<a;c++){const l=t+c*b,g=this.add.rectangle(l+b/2,i+b/2,b,b,6636321);this.physics.add.existing(g,!0),this.platforms.add(g)}}createPlayer(){const t=E/2,i=v/2;this.player=new ee(this,t,i,this.inputMapper),this.physics.add.collider(this.player,this.platforms)}update(t,i){this.inputMapper.update(),this.player.update(t,i)}}class We extends S.Scene{constructor(){super({key:"SideScrollerScene"});p(this,"inputMapper");p(this,"adManager");p(this,"player");p(this,"platforms");p(this,"fullscreenManager");p(this,"parallaxLayers",[]);p(this,"LEVEL_WIDTH",E*4)}create(){console.log("SideScrollerScene: Starting side-scrolling level..."),this.inputMapper=this.registry.get("inputMapper"),this.adManager=this.registry.get("adManager"),this.inputMapper.setScene(this),this.adManager.gameplayStart(),this.createParallaxLayers(),this.createPlatforms(),this.createPlayer(),this.cameras.main.setBounds(0,0,this.LEVEL_WIDTH,v),this.cameras.main.startFollow(this.player,!0,.08,.08),this.physics.world.setBounds(0,0,this.LEVEL_WIDTH,v),this.fullscreenManager=new re(this),this.fullscreenManager,new te(this,q),console.log("SideScrollerScene: Level ready")}createParallaxLayers(){const t=this.add.tileSprite(0,0,this.LEVEL_WIDTH,v,"parallax-sky");t.setOrigin(0,0),t.setScrollFactor(.1),this.parallaxLayers.push(t);const i=this.add.tileSprite(0,v-150,this.LEVEL_WIDTH,150,"parallax-mountains");i.setOrigin(0,0),i.setScrollFactor(.3),this.parallaxLayers.push(i);const a=this.add.tileSprite(0,v-120,this.LEVEL_WIDTH,120,"parallax-mid");a.setOrigin(0,0),a.setScrollFactor(.5),this.parallaxLayers.push(a);const c=this.add.tileSprite(0,v-80,this.LEVEL_WIDTH,80,"parallax-foreground");c.setOrigin(0,0),c.setScrollFactor(.7),this.parallaxLayers.push(c)}createPlatforms(){this.platforms=this.physics.add.staticGroup();const t=v-b;for(let i=0;i<this.LEVEL_WIDTH;i+=b){const a=this.add.rectangle(i+b/2,t+b/2,b,b,4881497);this.physics.add.existing(a,!0),this.platforms.add(a)}this.createPlatform(100,v-80,6),this.createPlatform(200,v-120,4),this.createPlatform(300,v-160,3),this.createPlatform(450,v-100,3),this.createPlatform(550,v-120,3),this.createPlatform(700,v-160,4),this.createPlatform(850,v-120,5),this.createPlatform(1e3,v-80,6),this.createPlatform(1200,v-140,3),this.createPlatform(1350,v-100,4),this.createPlatform(1500,v-180,3),this.createPlatform(1700,v-120,8),this.createPlatform(1900,v-80,10),this.createPlatform(2150,v-100,2),this.createPlatform(2250,v-140,2),this.createPlatform(2350,v-100,2),this.createPlatform(2450,v-160,3)}createPlatform(t,i,a){for(let c=0;c<a;c++){const l=t+c*b,g=this.add.rectangle(l+b/2,i+b/2,b,b,7048739);this.physics.add.existing(g,!0),this.platforms.add(g)}}createPlayer(){const t=E/4,i=v/2;this.player=new ee(this,t,i,this.inputMapper),this.physics.add.collider(this.player,this.platforms),this.player.setCollideWorldBounds(!0)}update(t,i){this.inputMapper.update(),this.player.update(t,i),this.updateParallax()}updateParallax(){const t=this.cameras.main;this.parallaxLayers.forEach(i=>{const a=i.scrollFactorX;i.tilePositionX=t.scrollX*a})}}const Ye={type:S.WEBGL,parent:"game-container",width:E,height:v,pixelArt:!0,roundPixels:!0,antialias:!1,backgroundColor:"#000000",input:{keyboard:!0,mouse:!0,touch:!0,gamepad:!1},scale:{mode:S.Scale.NONE,autoCenter:S.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{y:le,x:0},debug:!1}},scene:[Ke,Ve,Ge,Xe,We],fps:{target:60,forceSetTimeOut:!1},render:{pixelArt:!0,antialias:!1,antialiasGL:!1,roundPixels:!0}};class Ne{constructor(n){p(this,"game");this.game=n,this.setupScaling(),this.setupResizeListener()}setupScaling(){this.updateScale()}setupResizeListener(){window.addEventListener("resize",()=>{this.updateScale()})}updateScale(){const n=Math.floor(window.innerWidth/E),t=Math.floor(window.innerHeight/v),i=Math.max(1,Math.min(n,t)),a=E*i,c=v*i;this.game.scale.resize(E,v);const l=this.game.canvas;l&&(l.style.width=`${a}px`,l.style.height=`${c}px`,l.style.display="block",l.style.margin="0 auto")}forceUpdate(){this.updateScale()}}const ne=new S.Game(Ye),je=new Ne(ne);window.game=ne;window.scaleManager=je;console.log("Gatsby Guardians - Game initialized");
